{% set userMembership = user.memberRate.one() %}
{% set extraMemberships = [] %}

{% for member in extraMembers %}
    {% set memberRates = member.getFieldValue('memberRate') %}
    {% for rateId in memberRates %}
        {% set extraMemberships = extraMemberships|merge([rateId]) %}
    {% endfor %}
{% endfor %}

{% set allMemberships = extraMemberships|merge(user.memberRate.all()) %}

{% set totalPrice = 0 %}

<div class="box box--total" :class="openTotal ? 'box--total-open' : ''" x-data="{openTotal: false}">
    <div class="box__heading box__heading--center" @click="openTotal = ! openTotal">
        <h1>{{'Totaal'|t}}</h1>
        {{ svg("assets/icons/chevron-down.svg")|attr({class: 'box__icon box__icon--chevron' }) }}
    </div>
    <div class="box__content" x-collapse x-show="openTotal">
        <div class="box__wrapper">        
            {% for membership in allMemberships %}
                {% set totalPrice = totalPrice ? totalPrice.add(membership.price) :membership.price %}
                <div class="box__column box__column--4">            
                    <div class="box__info">
                        <p>{{ membership.title }}</p>
                        <p>{{ membership.price|money }}</p>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="box__column box__column--total box__column--2">            
            <p>Totaal:</p>
            <p>{{ totalPrice|money }}</p>
        </div>
        <form  method="post">
            {{ csrfInput() }}
            {{ actionInput('membership-payments/payment/initiate-payment') }}

            <button class="btn" type="submit" class="pay-button">Pay Now</button>
        </form>
    </div>
</div>